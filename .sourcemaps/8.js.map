{"version":3,"sources":["../../src/pages/login/login.module.ts","../../src/pages/login/login.ts"],"names":[],"mappings":"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","file":"8.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { IonicPageModule } from 'ionic-angular';\n\nimport { LoginPage } from './login';\n\n@NgModule({\n  declarations: [\n    LoginPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(LoginPage),\n    TranslateModule.forChild()\n  ],\n  exports: [\n    LoginPage\n  ]\n})\nexport class LoginPageModule { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, ToastController, LoadingController, NavParams } from 'ionic-angular';\n\nimport { Store } from \"../../models/store\";\nimport { Employee } from \"../../models/employee\";\nimport { EmployeesProvider } from '../../providers/providers';\nimport { MainPage } from '../pages';\nimport { Api } from \"../../providers/api/api\";\nimport { StorageProvider } from \"../../providers/storage/storage\";\n@IonicPage()\n@Component({\n  selector: 'page-login',\n  templateUrl: 'login.html'\n})\nexport class LoginPage {\n  account: { username: string, password: string } = {\n    username: '',\n    password: ''\n  };\n\n  private loginErrorString: string;\n  private store: any;\n  private employees: Employee[];\n  private storeName: string;\n\n  constructor(public navCtrl: NavController,\n    public loadingCtrl: LoadingController,\n    public employeesProvider: EmployeesProvider,\n    public toastCtrl: ToastController,\n    public navParams: NavParams,\n    public api: Api,\n    public storageProvider: StorageProvider) {\n\n    this.loginErrorString = \"登录失败，请检查用户名和密码后重试！\";\n    this.storeName = \"\";\n  }\n\n  ionViewWillEnter() {\n    // 检查门店信息是否存在\n    if(!this.store) {\n      // 从缓存获取数据信息\n      this.storageProvider.getStoreInfo().then(val => {\n        this.store = val;\n        console.log(this.store.Name);\n        this.storeName = this.store.Name;\n      });\n    } else {\n      console.log(\"门店信息存在\");\n      this.store = this.navParams.get('store');\n      this.storeName = this.store.Name;\n      console.log(this.store.Name);\n    }\n\n    let loader = this.loadingCtrl.create({\n      content: \"获取店铺信息...\"\n    });\n\n    loader.present().then(() => {\n      this.api.get(\"employees\").subscribe((resp) => {\n        let employeesArray = resp.json();\n        let employees = employeesArray.filter(item => {\n          return item.StoreID === this.store.ID;\n        });\n        this.employees = employees;\n        console.log(this.employees);\n        loader.dismiss();\n      }, (err) => {\n        loader.dismiss();\n      });\n    });\n  }\n\n  // 管理员登录\n  doLogin() {\n    let loader = this.loadingCtrl.create({\n      content: \"登录中...\"\n    });\n\n    loader.present().then(() => {\n      let employee = this.employees.filter((item) => {\n        return item.Account === this.account.username;\n      });\n      if (employee[0]) {\n        if (employee[0].Password === this.account.password) {\n          loader.dismiss();\n          console.log(\"登录成功！\");\n          // 保存管理员登录信息\n          this.storageProvider.saveEmployeeInfo(employee[0]);\n          // 设置账户状态为已登录\n          this.storageProvider.changeLoginState(true);\n          // 跳转到店铺信息首页\n          this.navCtrl.push(MainPage);\n        } else {\n          loader.dismiss();\n          console.log(\"密码错误！\");\n          const toast = this.toastCtrl.create({\n            message: this.loginErrorString,\n            duration: 1000,\n            position: 'bottom'\n          });\n          toast.present();\n        }\n      } else {\n        loader.dismiss();\n        console.log(\"用户不存在！\");\n        const toast = this.toastCtrl.create({\n          message: '用户不存在！',\n          duration: 1000,\n          position: 'bottom'\n        });\n        toast.present();\n      }\n    }, (err) => {\n      console.log(err);\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.ts"],"sourceRoot":""}
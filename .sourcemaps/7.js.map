{"version":3,"sources":["../../src/pages/login/login.module.ts","../../src/pages/login/login.ts"],"names":[],"mappings":"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","file":"7.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { IonicPageModule } from 'ionic-angular';\n\nimport { LoginPage } from './login';\n\n@NgModule({\n  declarations: [\n    LoginPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(LoginPage),\n    TranslateModule.forChild()\n  ],\n  exports: [\n    LoginPage\n  ]\n})\nexport class LoginPageModule { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, ToastController, LoadingController, NavParams } from 'ionic-angular';\n\nimport { Store } from \"../../models/store\";\nimport { Employee } from \"../../models/employee\";\nimport { EmployeesProvider } from '../../providers/providers';\nimport { MainPage } from '../pages';\nimport { Api } from \"../../providers/api/api\";\nimport { StorageProvider } from \"../../providers/storage/storage\";\n@IonicPage()\n@Component({\n  selector: 'page-login',\n  templateUrl: 'login.html'\n})\nexport class LoginPage {\n  account: { username: string, password: string } = {\n    username: '',\n    password: ''\n  };\n\n  private loginErrorString: string;\n  private store: any;\n  private employees: Employee[];\n  private storeName: string;\n\n  constructor(public navCtrl: NavController,\n    public loadingCtrl: LoadingController,\n    public employeesProvider: EmployeesProvider,\n    public toastCtrl: ToastController,\n    public navParams: NavParams,\n    public api: Api,\n    public storageProvider: StorageProvider) {\n\n    this.loginErrorString = \"登录失败，请检查用户名和密码后重试！\";\n    this.storeName = \"\";\n  }\n\n  ionViewWillEnter() {\n    // 1.首先从NavParams获取门店信息\n    this.store = this.navParams.get('store');\n    if (!this.store) {\n      // 2.沒有跳转参数的话从本地缓存获取\n      this.storageProvider.getStoreInfo().then(val => {\n        this.store = val;\n        this.storeName = this.store.Name;\n        // 3. 获取门店的店员信息\n        let loader = this.loadingCtrl.create({\n          content: \"获取店铺信息...\"\n        });\n        loader.present().then(() => {\n          this.api.get(\"employees\").subscribe((resp) => {\n            let employeesArray = resp.json();\n            let employees = employeesArray.filter(item => {\n              return item.StoreID === this.store.ID;\n            });\n            this.employees = employees;\n            console.log(this.employees);\n            loader.dismiss();\n          }, (err) => {\n            loader.dismiss();\n          });\n        });\n      }, (error) => {\n        console.log(\"获取门店信息失败\");\n      });\n    } else {\n      this.storeName = this.store.Name;\n      // 3. 获取门店的店员信息\n      let loader = this.loadingCtrl.create({\n        content: \"获取店铺信息...\"\n      });\n      loader.present().then(() => {\n        this.api.get(\"employees\").subscribe((resp) => {\n          let employeesArray = resp.json();\n          let employees = employeesArray.filter(item => {\n            return item.StoreID === this.store.ID;\n          });\n          this.employees = employees;\n          console.log(this.employees);\n          loader.dismiss();\n        }, (err) => {\n          loader.dismiss();\n        });\n      });\n    }\n  }\n\n  // 管理员登录\n  doLogin() {\n    let loader = this.loadingCtrl.create({\n      content: \"登录中...\"\n    });\n\n    loader.present().then(() => {\n      this.api.post('employees', { account: this.account.username, password: this.account.password}).subscribe((resp)=> {\n        console.log(resp.statusText);\n        // 保存管理员登录信息\n        this.storageProvider.saveEmployeeInfo(this.employees[0]);\n        // 设置账户状态为已登录\n        this.storageProvider.changeLoginState(true);\n        // 跳转到店铺信息首页\n        this.navCtrl.push(MainPage);\n        loader.dismiss();\n      }, (error)=> {\n        loader.dismiss();\n        this.loginErrorString = \"请确认用户名和密码后重试！\";\n        const toast = this.toastCtrl.create({\n          message: this.loginErrorString,\n          duration: 1000,\n          position: 'bottom'\n        });\n        toast.present();\n      });\n      // let employee = this.employees.filter((item) => {\n      //   return item.Account === this.account.username;\n      // });\n      // if (employee[0]) {\n      //   if (employee[0].Password === this.account.password) {\n      //     loader.dismiss();\n      //     console.log(\"登录成功！\");\n      //     // 保存管理员登录信息\n      //     this.storageProvider.saveEmployeeInfo(employee[0]);\n      //     // 设置账户状态为已登录\n      //     this.storageProvider.changeLoginState(true);\n      //     // 跳转到店铺信息首页\n      //     this.navCtrl.push(MainPage);\n      //   } else {\n      //     loader.dismiss();\n      //     console.log(\"密码错误！\");\n      //     const toast = this.toastCtrl.create({\n      //       message: this.loginErrorString,\n      //       duration: 1000,\n      //       position: 'bottom'\n      //     });\n      //     toast.present();\n      //   }\n      // } else {\n      //   loader.dismiss();\n      //   console.log(\"用户不存在！\");\n      //   const toast = this.toastCtrl.create({\n      //     message: '用户不存在！',\n      //     duration: 1000,\n      //     position: 'bottom'\n      //   });\n      //   toast.present();\n      // }\n    }, (err) => {\n      console.log(err);\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.ts"],"sourceRoot":""}